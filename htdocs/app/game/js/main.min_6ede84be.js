var __reflect=this&&this.__reflect||function(t,e,a){t.__class__=e,a?a.push(e):a=[e],t.__types__=t.__types__?a.concat(t.__types__):a},__extends=this&&this.__extends||function(t,e){function a(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);a.prototype=e.prototype,t.prototype=new a},__awaiter=this&&this.__awaiter||function(t,e,a,n){return new(a||(a=Promise))(function(i,r){function o(t){try{l(n.next(t))}catch(e){r(e)}}function s(t){try{l(n["throw"](t))}catch(e){r(e)}}function l(t){t.done?i(t.value):new a(function(e){e(t.value)}).then(o,s)}l((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function a(t){return function(e){return n([t,e])}}function n(a){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,r&&(o=r[2&a[0]?"return":a[0]?"throw":"next"])&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[0,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return l.label++,{value:a[1],done:!1};case 5:l.label++,r=a[1],a=[0];continue;case 7:a=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){l=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){l.label=a[1];break}if(6===a[0]&&l.label<o[1]){l.label=o[1],o=a;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(a);break}o[2]&&l.ops.pop(),l.trys.pop();continue}a=e.call(t,l)}catch(n){a=[6,n],r=0}finally{i=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var i,r,o,s,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),"throw":a(1),"return":a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},StartGamePanel=function(t){function e(e){var a=t.call(this)||this;a._tiles=[],a._sheet=e,a.createMap(),a.randomMap();var n=new egret.Bitmap;return n.texture=e.getTexture("btn_start"),n.x=(GameData.stageWidth-n.width)/2,n.y=300,a.addChild(n),a.touchEnabled=!0,a.addEventListener(egret.TouchEvent.TOUCH_TAP,a.onClickBegin,a),a}return __extends(e,t),e.prototype.createMap=function(){for(var t=0;81>t;t++){var e=new Tile(this._sheet);this.addChild(e),e.index=t,e.x=Util.getPonitByIndex(t).x,e.y=Util.getPonitByIndex(t).y,this._tiles.push(e)}},e.prototype.randomMap=function(){GameData.getInstance().initTilesData(),GameData.getInstance().randomCloseTile();for(var t=GameData.getInstance().tilesData,e=0;e<t.length;e++)0==t[e]&&this._tiles[e].close()},e.prototype.onClickBegin=function(){ViewManager.getInstance().startGame()},e.prototype.release=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickBegin,this)},e}(egret.DisplayObjectContainer);__reflect(StartGamePanel.prototype,"StartGamePanel");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=640,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var BackGroundPanel=function(t){function e(e){var a=t.call(this)||this,n=new egret.Bitmap;return n.texture=e.getTexture("bg"),a.addChild(n),n.width=GameData.stageWidth,n.height=GameData.stageHeight,a}return __extends(e,t),e}(egret.DisplayObjectContainer);__reflect(BackGroundPanel.prototype,"BackGroundPanel");var GameOverPanel=function(t){function e(e){var a=t.call(this)||this;return a._shadow=new egret.Shape,a._shadow.graphics.beginFill(16777215,.3),a._shadow.graphics.drawRect(0,0,750,1200),a._shadow.graphics.endFill(),a.addChild(a._shadow),a._shadow.addEventListener(egret.TouchEvent.TOUCH_TAP,a.onReturn,a),a._successBt=new egret.Bitmap,a._successBt.texture=e.getTexture("victory"),a._successBt.x=(GameData.stageWidth-a._successBt.width-33)/2,a._successBt.y=(GameData.stageHeight-a._successBt.height)/2,a.addChild(a._successBt),a._successBt.visible=!1,a._failBt=new egret.Bitmap,a._failBt.texture=e.getTexture("failed"),a._failBt.x=(GameData.stageWidth-a._failBt.width-33)/2,a._failBt.y=(GameData.stageHeight-a._failBt.height)/2,a.addChild(a._failBt),a._failBt.visible=!1,a._gameText=new egret.TextField,a.addChild(a._gameText),a._gameText.size=28,a._gameText.textColor=16711680,a._gameText.bold=!0,a._gameText.width=a._successBt.width,a._gameText.textAlign=egret.HorizontalAlign.CENTER,a._gameText.x=(GameData.stageWidth-a._successBt.width)/2,a._gameText.y=(GameData.stageHeight-a._failBt.height)/2+200,a._gameTextWarn=new egret.TextField,a.addChild(a._gameTextWarn),a._gameTextWarn.size=28,a._gameTextWarn.textColor=16777215,a._gameTextWarn.strokeColor=0,a._gameTextWarn.stroke=1,a._gameTextWarn.bold=!0,a._gameTextWarn.width=a._successBt.width,a._gameTextWarn.textAlign=egret.HorizontalAlign.CENTER,a._gameTextWarn.x=(GameData.stageWidth-a._successBt.width)/2,a._gameTextWarn.y=(GameData.stageHeight-a._failBt.height)/2+250,a._gameTextSucc=new egret.TextField,a.addChild(a._gameTextSucc),a._gameTextSucc.size=28,a._gameTextSucc.textColor=16711680,a._gameTextSucc.bold=!0,a._gameTextSucc.width=a._successBt.width,a._gameTextSucc.textAlign=egret.HorizontalAlign.CENTER,a._gameTextSucc.x=(GameData.stageWidth-a._successBt.width)/2,a._gameTextSucc.y=(GameData.stageHeight-a._failBt.height)/2+250,a._moreBtn=new egret.Bitmap,a._moreBtn.texture=e.getTexture("replay"),a.addChild(a._moreBtn),a._moreBtn.x=(GameData.stageWidth-a._moreBtn.width)/2,a._moreBtn.y=(GameData.stageHeight-a._failBt.height)/2+a._failBt.height+20,a._moreBtn.touchEnabled=!0,a._moreBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,a.onRestart,a),a}return __extends(e,t),e.prototype.showGameoverPanel=function(t){if(t){this._successBt.visible=!0,this._failBt.visible=!1;var e=["感觉自己萌萌哒","智商一等一","迷你王中王","迷妹遍天下","头号小可爱"];GameData.step<15&&(this._gameTextSucc.text="获得称号："+e[1]),GameData.step<20&&GameData.step>=15&&(this._gameTextSucc.text="获得称号："+e[2]),GameData.step<25&&GameData.step>=20&&(this._gameTextSucc.text="获得称号："+e[3]),GameData.step<30&&GameData.step>=25&&(this._gameTextSucc.text="获得称号："+e[4]),GameData.step>=30&&(this._gameTextSucc.text="获得称号："+e[0]),this._gameText.text="您用"+GameData.step+"步捉住了单身狗!",this._gameTextWarn.text=""}else this._successBt.visible=!1,this._failBt.visible=!0,this._gameText.text="你没有抓住单！身！狗！",this._gameTextWarn.text="精神病院长又发疯了",this._gameTextSucc.text=""},e.prototype.onRestart=function(){ViewManager.getInstance().restartGame()},e.prototype.onReturn=function(){ViewManager.getInstance().restartGame()},e.prototype.release=function(){this._moreBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRestart,this)},e}(egret.DisplayObjectContainer);__reflect(GameOverPanel.prototype,"GameOverPanel");var GamePanel=function(t){function e(e){var a=t.call(this)||this;return a._tiles=[],a._sheet=e,a.addEventListener(egret.Event.ADDED_TO_STAGE,function(){a.createMap(),a.randomMap(),a.createCat()},a),a}return __extends(e,t),e.prototype.createMap=function(){for(var t=0;81>t;t++){var e=new Tile(this._sheet);this.addChild(e),e.index=t,e.x=Util.getPonitByIndex(t).x,e.y=Util.getPonitByIndex(t).y,this._tiles.push(e),e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickTile,this)}},e.prototype.onClickTile=function(t){var e=t.currentTarget,a=GameData.getInstance().getTileStatus(e.index);if(!a||GameData.catIndex==e.index)return!1;e.close(),GameData.getInstance().closeTileDataByIndex(e.index),GameData.step++;var n=GameData.getInstance().isHaveNextPoint();n?this.updateCat():(this.gameover(),this.release())},e.prototype.updateCat=function(){this._cat.x=Util.getPonitByIndex(GameData.catIndex).x+30,this._cat.y=Util.getPonitByIndex(GameData.catIndex).y+30,this._cat.isMC1=GameData.catIsMC1},e.prototype.gameover=function(){ViewManager.getInstance().gameover()},e.prototype.randomMap=function(){GameData.getInstance().initTilesData(),GameData.getInstance().randomCloseTile();for(var t=GameData.getInstance().tilesData,e=0;e<t.length;e++)0==t[e]&&this._tiles[e].close()},e.prototype.createCat=function(){this._cat=new Cat,this.addChild(this._cat),this._cat.x=Util.getPonitByIndex(40).x+30,this._cat.y=Util.getPonitByIndex(40).y+30},e.prototype.release=function(){for(var t=this._tiles.length,e=0;t>e;e++)this._tiles[e].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickTile,this)},e}(egret.DisplayObjectContainer);__reflect(GamePanel.prototype,"GamePanel");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return a.sent(),[4,RES.loadGroup("preload",0,t)];case 2:return a.sent(),this.stage.removeChild(t),[3,4];case 3:return e=a.sent(),console.error(e),[3,4];case 4:return[2]}})})},e.prototype.createGameScene=function(){GameData.stageWidth=this.stage.stageWidth,GameData.stageHeight=this.stage.stageHeight;var t=ViewManager.getInstance();t.initView(this),t.showStart()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Util=function(){function t(){}return t.getPonitByIndex=function(t){var e=Math.floor(t/9),a=t%9,n=new egret.Point,i=GameData.stageHeight-540-50,r=(GameData.stageWidth-540)/2,o=0;return e%2!=0&&(o=30),n.x=r+60*a+o,n.y=i+60*e,n},t.getRowAndColByIndex=function(t){var e=new egret.Point;return e.x=Math.floor(t/9),e.y=t%9,e},t.getIndexByRowAndCol=function(t,e){return 9*t+e},t}();__reflect(Util.prototype,"Util");var ViewManager=function(){function t(){}return t.getInstance=function(){return t._shared||(t._shared=new t),t._shared},t.prototype.initView=function(t){this._rootView=t,this._sheet=RES.getRes("gameres_json"),this._bgPanel=new BackGroundPanel(this._sheet),this._rootView.addChild(this._bgPanel),this._startPanel=new StartGamePanel(this._sheet),this._gamePanel=new GamePanel(this._sheet),this._gameoverPanel=new GameOverPanel(this._sheet)},t.prototype.showStart=function(){this._rootView.addChild(this._startPanel)},t.prototype.startGame=function(){this._startPanel.parent&&(this._startPanel.release(),this._rootView.removeChild(this._startPanel),this._startPanel=null,this._rootView.addChild(this._gamePanel))},t.prototype.gameover=function(){this._gameoverPanel.showGameoverPanel(GameData.isSuccess),this._rootView.addChild(this._gameoverPanel)},t.prototype.restartGame=function(){this._gameoverPanel.parent&&(this._gamePanel.release(),this._rootView.removeChild(this._gameoverPanel),this._rootView.removeChild(this._gamePanel),this._gamePanel=null,this._gamePanel=new GamePanel(this._sheet),this._rootView.addChild(this._gamePanel),GameData.getInstance().initData())},t}();__reflect(ViewManager.prototype,"ViewManager");var CatAI=function(){function t(){}return t.prototype.isExit=function(t){var e=Util.getRowAndColByIndex(t).x,a=Util.getRowAndColByIndex(t).y;return 0==e||8==e||0==a||8==a?!0:!1},t.prototype.findNextPonit=function(){this.initMap();var t=this.findPath();if(null==t)return null;for(var e;;){if(e=this._map[t].preIndex,e==GameData.catIndex)return t;t=e}},t.prototype.getNear=function(){var t=this.findRound(GameData.catIndex);return t[0]},t.prototype.initMap=function(){null==this._map&&(this._map=[]);for(var t=0;81>t;t++)this._map.push(new TileNode);for(var t=0;81>t;t++)this._map[t].clean(),0==GameData.getInstance().tilesData[t]&&(this._map[t].isUsed=!0)},t.prototype.findPath=function(){for(var t,e,a,n=GameData.catIndex,i=[n],r=[];;){if(0==i.length)return null;for(var o=[],s=i.length,l=0;s>l;l++){t=i.shift(),e=this.findRound(t),a=e.length;for(var c=0;a>c;c++)if(!(r.indexOf(e[c])>-1||i.indexOf(e[c])>-1)){if(this._map[e[c]].preIndex=t,this.isExit(e[c]))return e[c];o.push(e[c])}r.push(t)}i=o}},t.prototype.findRound=function(t){var e=[],a=Util.getRowAndColByIndex(t).x,n=Util.getRowAndColByIndex(t).y,i=a-1;i>=0&&0==this._map[Util.getIndexByRowAndCol(i,n)].isUsed&&e.push(Util.getIndexByRowAndCol(i,n));var r=a+1;8>=r&&0==this._map[Util.getIndexByRowAndCol(r,n)].isUsed&&e.push(Util.getIndexByRowAndCol(r,n));var o=n-1;o>=0&&0==this._map[Util.getIndexByRowAndCol(a,o)].isUsed&&e.push(Util.getIndexByRowAndCol(a,o));var s=n+1;if(8>=s&&0==this._map[Util.getIndexByRowAndCol(a,s)].isUsed&&e.push(Util.getIndexByRowAndCol(a,s)),a%2==0){var l=n-1,c=a-1;l>=0&&c>=0&&0==this._map[Util.getIndexByRowAndCol(c,l)].isUsed&&e.push(Util.getIndexByRowAndCol(c,l));var h=a+1;l>=0&&8>=h&&0==this._map[Util.getIndexByRowAndCol(h,l)].isUsed&&e.push(Util.getIndexByRowAndCol(h,l))}else{var d=n+1,u=a-1;8>=d&&u>=0&&0==this._map[Util.getIndexByRowAndCol(u,d)].isUsed&&e.push(Util.getIndexByRowAndCol(u,d));var _=a+1;8>=d&&8>=_&&0==this._map[Util.getIndexByRowAndCol(_,d)].isUsed&&e.push(Util.getIndexByRowAndCol(_,d))}return e.sort(),e},t}();__reflect(CatAI.prototype,"CatAI");var TileNode=function(){function t(){}return t.prototype.clean=function(){this.preIndex=-1,this.isUsed=!1},t}();__reflect(TileNode.prototype,"TileNode");var GameData=function(){function t(){this._catAI=new CatAI}return t.getInstance=function(){return t._shared||(t._shared=new t),t._shared},t.prototype.initTilesData=function(){null==this.tilesData&&(this.tilesData=[]);for(var t=0;81>t;t++)this.tilesData[t]=!0},t.prototype.randomCloseTile=function(){for(var t=Math.floor(10*Math.random()+20),e=0;t>e;e++){var a=Math.floor(81*Math.random());this.tilesData[a]=!1}this.tilesData[40]=!0},t.prototype.closeTileDataByIndex=function(t){this.tilesData[t]=!1},t.prototype.getTileStatus=function(t){return this.tilesData[t]},t.prototype.isHaveNextPoint=function(){if(this._catAI.isExit(t.catIndex))return t.isSuccess=!1,!1;var e=this._catAI.findNextPonit();return null==e?(t.catIsMC1=!1,t.catIndex=this._catAI.getNear(),t.catIndex?!0:(t.isSuccess=!0,!1)):(t.catIndex=e,!0)},t.prototype.initData=function(){t.step=0,t.catIndex=40,t.catIsMC1=!0,t.isSuccess=!1},t.step=0,t.catIndex=40,t.catIsMC1=!0,t}();__reflect(GameData.prototype,"GameData");var Cat=function(t){function e(){var e=t.call(this)||this,a=RES.getRes("action1_json"),n=RES.getRes("action1_png"),i=new egret.MovieClipDataFactory(a,n),r=i.generateMovieClipData("stay");e._mc1=new egret.MovieClip(r),e.addChild(e._mc1),e._mc1.play(-1),a=RES.getRes("action2_json"),n=RES.getRes("action2_png");var o=new egret.MovieClipDataFactory(a,n),s=o.generateMovieClipData("weizhu");return e._mc2=new egret.MovieClip(s),e._mc2.play(-2),e._isMc1=!0,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height,e}return __extends(e,t),Object.defineProperty(e.prototype,"isMC1",{set:function(t){this.numChildren&&this.removeChildren(),this._isMc1=t,t?this.addChild(this._mc1):this.addChild(this._mc2)},enumerable:!0,configurable:!0}),e}(egret.DisplayObjectContainer);__reflect(Cat.prototype,"Cat");var Tile=function(t){function e(e){var a=t.call(this)||this;return a._openBt=new egret.Bitmap,a._openBt.texture=e.getTexture("pot1"),a.addChild(a._openBt),a._closeBt=new egret.Bitmap,a._closeBt.texture=e.getTexture("pot2"),a._isOpen=!0,a}return __extends(e,t),e.prototype.close=function(){this._isOpen&&(this._isOpen=!1,this.removeChild(this._openBt),this.addChild(this._closeBt))},Object.defineProperty(e.prototype,"index",{get:function(){return this._index},set:function(t){this._index=t},enumerable:!0,configurable:!0}),e}(egret.DisplayObjectContainer);__reflect(Tile.prototype,"Tile");